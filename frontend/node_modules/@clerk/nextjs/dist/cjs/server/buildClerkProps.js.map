{"version":3,"sources":["../../../src/server/buildClerkProps.ts"],"sourcesContent":["import type { AuthObject, Organization, Session, User } from '@clerk/backend';\nimport { makeAuthObjectSerializable, stripPrivateDataFromObject } from '@clerk/backend/internal';\n\nimport { getAuthDataFromRequest } from './data/getAuthDataFromRequest';\nimport type { RequestLike } from './types';\n\ntype BuildClerkPropsInitState = { user?: User | null; session?: Session | null; organization?: Organization | null };\n\n/**\n * To enable Clerk SSR support, include this object to the `props`\n * returned from `getServerSideProps`. This will automatically make the auth state available to\n * the Clerk components and hooks during SSR, the hydration phase and CSR.\n * @example\n * import { getAuth } from '@clerk/nextjs/server';\n *\n * export const getServerSideProps = ({ req }) => {\n *   const { authServerSideProps } = getAuth(req);\n *   const myData = getMyData();\n *\n *   return {\n *     props: { myData, authServerSideProps },\n *   };\n * };\n */\ntype BuildClerkProps = (req: RequestLike, authState?: BuildClerkPropsInitState) => Record<string, unknown>;\n\nexport const buildClerkProps: BuildClerkProps = (req, initialState = {}) => {\n  const sanitizedAuthObject = getDynamicAuthData(req, initialState);\n\n  // Serializing the state on dev env is a temp workaround for the following issue:\n  // https://github.com/vercel/next.js/discussions/11209|Next.js\n  const __clerk_ssr_state =\n    process.env.NODE_ENV !== 'production' ? JSON.parse(JSON.stringify(sanitizedAuthObject)) : sanitizedAuthObject;\n  return { __clerk_ssr_state };\n};\n\nexport function getDynamicAuthData(req: RequestLike, initialState = {}) {\n  const authObject = getAuthDataFromRequest(req);\n\n  return makeAuthObjectSerializable(stripPrivateDataFromObject({ ...authObject, ...initialState })) as AuthObject;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,sBAAuE;AAEvE,oCAAuC;AAuBhC,MAAM,kBAAmC,CAAC,KAAK,eAAe,CAAC,MAAM;AAC1E,QAAM,sBAAsB,mBAAmB,KAAK,YAAY;AAIhE,QAAM,oBACJ,QAAQ,IAAI,aAAa,eAAe,KAAK,MAAM,KAAK,UAAU,mBAAmB,CAAC,IAAI;AAC5F,SAAO,EAAE,kBAAkB;AAC7B;AAEO,SAAS,mBAAmB,KAAkB,eAAe,CAAC,GAAG;AACtE,QAAM,iBAAa,sDAAuB,GAAG;AAE7C,aAAO,gDAA2B,4CAA2B,EAAE,GAAG,YAAY,GAAG,aAAa,CAAC,CAAC;AAClG;","names":[]}